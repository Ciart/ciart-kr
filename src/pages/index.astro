---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { getPostDateText } from '../helpers/date';

const posts = await getCollection('blog');
const sortedPosts = posts
  .sort((a, b) => b.data.created.valueOf() - a.data.created.valueOf())
  .map((post) => ({
    ...post,
    body:
      post.body &&
      post.body.substring(0, 100) + (post.body.length > 200 ? '...' : ''),
  }));
---

<Layout>
  <div class="flex flex-col gap-4">
    {
      sortedPosts.map((post) => (
        <a href={post.data.permalink}>
            <div class="flex justify-between items-baseline">
              <h2 class="font-bold" transition:name={`post-title-${post.id}`}>{post.data.title}</h2>
              <p class="text-sm" transition:name={`post-date-${post.id}`}>{getPostDateText(post)}</p>
            </div>
            <p>{post.body}</p>
        </a>
      ))
    }
  </div>
</Layout>
