---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import { getPostDateText } from '../helpers/date';

const posts = await getCollection('blog');
const sortedPosts = posts
  .sort((a, b) => b.data.created.valueOf() - a.data.created.valueOf())
  .map((post) => ({
    ...post,
    body:
      post.body &&
      post.body.substring(0, 100) + (post.body.length > 200 ? '...' : ''),
  }));
---

<Layout>
  <div class="flex flex-col gap-4">
    <div>
      <a
        class="block w-[12.5rem] rounded-md hover:ring-8 hover:ring-black/5 active:ring-4 active:ring-black/10 transition-all"
        href="/"
      >
        <img
          class="size full rounded-md"
          src="https://placehold.co/200@2x.png"
          alt=""
        />
      </a>
    </div>
    <div class="flex flex-col gap-4">
      {
        sortedPosts.map((post) => (
          <a href={post.data.permalink}>
            <div class="flex justify-between items-baseline">
              <h2 class="font-bold">{post.data.title}</h2>
              <p class="text-sm">{getPostDateText(post)}</p>
            </div>
            <p class="text-[15px]">{post.body}</p>
          </a>
        ))
      }
    </div>
  </div>
</Layout>
